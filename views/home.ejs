<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/_head.ejs') %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #E0E0E0;
      font-family: 'Roboto', sans-serif;
    }
    .marquee-container {
      position: relative;
      background-color: #1E1E1E;
      padding: 10px 0;
    }
    .marquee {
      color: #E0E0E0;
      font-size: 16px;
      white-space: nowrap;
      overflow: hidden;
      display: block;
    }
    .marquee p {
      display: inline-block;
      animation: marquee 15s linear infinite;
    }
    @keyframes marquee {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
    .marquee-border {
      border-bottom: 3px solid #1DB954; /* Spotify green */
    }
    .menu-list {
      display: flex;
      justify-content: space-around;
      background-color: #1E1E1E;
      padding: 15px 0;
      margin-bottom: 20px;
      border-radius: 8px; /* Add border-radius */
    }
    .menu-item {
      text-align: center;
      color: #E0E0E0;
    }
    .menu-item .card {
      background-color: #222;
      border: none;
      padding: 15px;
      border-radius: 8px; /* Add border-radius */
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      transition: background-color 0.3s;
    }
    .menu-item .card:hover {
      background-color: #333;
    }
    .menu-item i {
      font-size: 24px;
      margin-bottom: 5px;
    }
    .menu-item span {
      display: block;
    }
    .menu-item a {
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .page-header {
      background: linear-gradient(135deg, #1DB954 0%, #1a472a 100%);
      padding: 20px;
      border-radius: 8px; /* Add border-radius */
      margin-bottom: 20px;
    }
    .profile-cover {
      margin-bottom: 20px;
    }
    .profile-cover-img {
      border-radius: 8px; /* Add border-radius */
      width: 100%;
    }
    .avatar-container {
      position: relative;
      width: 160px;
      height: 160px;
      margin: auto;
    }
    .avatar {
      border: 2px solid #1DB954;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
    }
    .lottie-avatar-frame {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 160px;
      height: 160px;
      z-index: 1;
    }
    .settings-btn {
      background-color: #1DB954;
      color: #121212;
      border: none;
      transition: background-color 0.3s;
    }
    .settings-btn:hover {
      background-color: #17a74a;
    }
    .content-space-b-2 {
      margin-bottom: 40px;
    }
    .announcement {
      background-color: #1E1E1E;
      padding: 10px;
      border-radius: 8px; /* Add border-radius */
    }
    .card-transition {
      transition: transform 0.3s;
    }
    .card-transition:hover {
      transform: scale(1.05);
    }
    .nav-segment .nav-link.active {
      background-color: #1DB954;
      color: #121212;
    }
    @media (max-width: 768px) {
      .page-header .d-flex {
        flex-direction: column;
        align-items: center;
      }
      .avatar-container {
        margin-bottom: 10px;
      }
      .button-group {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
      }
    }
  </style>
</head>
<body class="<%= themePreference %>">
  <%- include('./partials/_header.ejs') %>

  <div class="container mt-5">
    <!-- Marquee Announcement -->
    <div class="marquee-container marquee-border">
      <div class="marquee">
        <p>Welcome to our platform! Enjoy our services and have a great experience. Stay tuned for more updates.</p>
      </div>
    </div>

    <!-- Menu List -->
    <div class="menu-list">
      <div class="menu-item">
        <a href="/service">
          <div class="card card-transition">
            <i class="fas fa-concierge-bell"></i>
            <span>Service</span>
          </div>
        </a>
      </div>
      <div class="menu-item">
        <a href="/event">
          <div class="card card-transition">
            <i class="fas fa-calendar-alt"></i>
            <span>Event</span>
          </div>
        </a>
      </div>
      <div class="menu-item">
        <a href="/withdrawal">
          <div class="card card-transition">
            <i class="fas fa-money-check-alt"></i>
            <span>Withdrawal</span>
          </div>
        </a>
      </div>
      <div class="menu-item">
        <a href="/deposit">
          <div class="card card-transition">
            <i class="fas fa-credit-card"></i>
            <span>Deposit</span>
          </div>
        </a>
      </div>
    </div>

    <!-- Content -->
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <div class="d-flex">
          <div class="avatar-container mb-2 mb-sm-0">
            <div id="lottie-avatar-frame" class="lottie-avatar-frame"></div>
            <img class="avatar avatar-xl" src="/img/160x160/img3.jpg" alt="Profile Picture">
          </div>
          <div class="flex-grow-1 ms-3">
            <h1 class="h2 mb-1 text-white">Welcome, <%= username %>!
              <picture>
                <source srcset="https://fonts.gstatic.com/s/e/notoemoji/latest/1f44b/512.webp" type="image/webp">
                <img src="https://fonts.gstatic.com/s/e/notoemoji/latest/1f44b/512.gif" alt="ðŸ‘‹" width="32" height="32">
              </picture>
            </h1>
            <div class="d-flex gap-1">
              <span class="fw-semibold text-white ms-1">Balance: <span id="balance"><%= balance %></span> USDT</span>
            </div>
            <span class="fw-semibold text-white ms-1">Status: <%= accountStatus %></span>
            <p class="fw-semibold text-white ms-1">Commission: <span id="commission"><%= commission %></span> USDT</p>
            <p class="fw-semibold text-white ms-1">Referral Rewards: <%= user.rewards %></p>
            <p class="fw-semibold text-white ms-1">Loyalty Points: <%= user.loyaltyPoints %></p>
            <p class="fw-semibold text-white ms-1">Tier: <%= user.tier %></p> <!-- Display user tier -->
            <% if (user.loyaltyPoints >= 100) { %>
              <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#redeemPointsModal">Redeem Points</button>
            <% } %>
          </div>
        </div>
        <div class="mt-3">
          <a class="btn btn-primary d-block mb-2" id="dailyRewardBtn" data-bs-toggle="modal" data-bs-target="#dailyrewardmodal">Daily rewards</a>
          <a class="btn settings-btn d-block" data-bs-toggle="offcanvas" data-bs-target="#settingsOffcanvas" aria-controls="settingsOffcanvas" href="#">
            <i class="bi bi-gear me-1"></i>Settings
          </a>
        </div>
      </div>
    </div>
      <!-- Modal -->
      <div id="dailyrewardmodal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="dailyrewardmodal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="dailyrewardmodal">Daily reward</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex flex-column align-items-center">
              <img src="/svg/illustrations/oc-money-profits.svg" />
              <p class="text-center">Daily reward ready!</p>
              <button class="btn btn-primary" id="claimDailyReward">Claim daily reward</button>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-white" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
     <!-- Offcanvas -->
      <div class="offcanvas offcanvas-start" tabindex="-1" id="settingsOffcanvas" aria-labelledby="offcanvasExampleLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasExampleLabel">Offcanvas</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <div>
            Some text as placeholder. In real life you can have the elements you have chosen. Like, text, images, lists, etc.
          </div>
          <div class="dropdown mt-3">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown">
              Dropdown button
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#">Action</a></li>
              <li><a class="dropdown-item" href="#">Another action</a></li>
              <li><a class="dropdown-item" href="#">Something else here</a></li>
            </ul>
          </div>
        </div>
      </div>

    <!-- End Page Header -->

    <div class="announcements-section mt-5">
      <h2 class="text-white">Announcements</h2>
      <% announcements.forEach(function(announcement) { %>
        <div class="announcement mb-3">
          <h3 class="text-white"><%= announcement.title %></h3>
          <p class="text-white"><%= announcement.content %></p>
          <p class="text-white">Posted on: <%= announcement.createdAt.toDateString() %></p>
        </div>
      <% }); %>
    </div>
  </div>
</div>

<%- include('./partials/_footer.ejs') %>

<!-- JS Plugins Init. -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/walletInfo.js"></script>
<script src="/js/balanceUpdates.js"></script>
<script src="/js/dailyRewards.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script src="/vendor/shufflejs/dist/shuffle.js"></script>
<script src="/vendor/hs-nav-scroller/dist/hs-nav-scroller.min.js"></script>
<script src="/vendor/typed.js/lib/typed.min.js"></script>
<script src="/js/toastrNotifications.js"></script>
<script src="/js/modalItemDetails.js" defer></script>

<!-- Lottie Animation Initialization Script -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Lottie animation based on user tier
    var tier = "<%= user.tier %>";
    var lottiePath;
    var avatarSize;
    var avatarPosition;

    switch(tier) {
      case 'VIP1':
        lottiePath = '/Animations/vip1.json';
        avatarSize = { width: '84px', height: '85px' }; // Adjusted size for VIP1
        avatarPosition = { top: '50%', transform: 'translate(-50%, -50%)' }; // Adjusted position for VIP1
        break;
      case 'VIP2':
        lottiePath = '/Animations/vip2.json';
        avatarSize = { width: '95px', height: '95px' }; // Current size for VIP2
        avatarPosition = { top: '55%', transform: 'translate(-50%, -50%)' }; // Default position for VIP2
        break;
      case 'VIP3':
        lottiePath = '/Animations/vip3.json';
        avatarSize = { width: '75px', height: '75px' }; // Adjusted size for VIP3
        avatarPosition = { top: '48%', transform: 'translate(-50%, -50%)' }; // Adjusted position for VIP3
        break;
      default:
        lottiePath = '/Animations/frames.json'; // default frame
        avatarSize = { width: '90px', height: '90px' }; // Default size
        avatarPosition = { top: '50%', transform: 'translate(-50%, -50%)' }; // Default position
    }

    console.log('Loading Lottie animation from path:', lottiePath);

    // Set avatar size and position
    var avatar = document.querySelector('.avatar');
    avatar.style.width = avatarSize.width;
    avatar.style.height = avatarSize.height;
    avatar.style.top = avatarPosition.top;
    avatar.style.transform = avatarPosition.transform;

    lottie.loadAnimation({
      container: document.getElementById('lottie-avatar-frame'),
      renderer: 'svg',
      loop: true,
      autoplay: true,
      path: lottiePath
    });

    // Handle daily reward claim
    var dailyRewardBtn = document.getElementById('dailyRewardBtn');
    var dailyRewardClaimed = <%= dailyRewardClaimed ? 'true' : 'false' %>;

    if (dailyRewardClaimed) {
      dailyRewardBtn.classList.add('disabled');
      dailyRewardBtn.innerText = 'Reward claimed';
    }

    document.getElementById('claimDailyReward').addEventListener('click', function() {
      fetch('/api/claim-daily-reward', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            toastr.success('Daily reward claimed!');
            dailyRewardBtn.classList.add('disabled');
            dailyRewardBtn.innerText = 'Reward claimed';
          } else {
            toastr.error('Failed to claim daily reward');
          }
        })
        .catch(error => {
          console.error('Error claiming daily reward:', error);
          toastr.error('Failed to claim daily reward');
        });
    });
  });
</script>

</body>
</html>
